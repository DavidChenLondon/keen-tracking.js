{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./node_modules/keen-core/lib/utils/each.js","webpack:///./node_modules/keen-core/lib/utils/extend.js","webpack:///external \"keen-core\"","webpack:///external \"js-cookie\"","webpack:///external \"component-emitter\"","webpack:///./node_modules/keen-core/lib/utils/base64.js","webpack:///./lib/utils/queue.js","webpack:///./lib/index.js","webpack:///./lib/utils/listener.js","webpack:///./lib/utils/deepExtend.js","webpack:///./lib/extend-events.js","webpack:///./lib/record-events-browser.js","webpack:///./lib/defer-events.js","webpack:///./lib/browser-auto-tracking.js","webpack:///./lib/helpers/getScreenProfile.js","webpack:///./lib/helpers/getWindowProfile.js","webpack:///./lib/helpers/getBrowserProfile.js","webpack:///./lib/helpers/getDatetimeIndex.js","webpack:///./lib/helpers/getDomainName.js","webpack:///./lib/helpers/getDomNodePath.js","webpack:///./lib/helpers/getDomNodeProfile.js","webpack:///./lib/helpers/getScrollState.js","webpack:///./lib/helpers/getUniqueId.js","webpack:///./lib/utils/cookie.js","webpack:///./lib/utils/serializeForm.js","webpack:///./lib/utils/timer.js","webpack:///./lib/browser.js"],"names":["capacity","config","interval","events","timer","Emitter","queue","prototype","check","shouldFlushQueue","flush","pause","emit","clearInterval","start","self","setInterval","props","KeenCore","helpers","on","client","extensions","collections","recordDeferredEvents","writeKey","str","arguments","length","String","setGlobalProperties","log","globalProperties","listenerCore","ctx","domListeners","listener","selector","fn","addListener","eventHandler","push","once","off","apply","survivors","each","handler","i","e","hash","eventType","evt","target","window","event","srcElement","handlers","key","matches","nodeName","deferClickEvent","deferFormSubmit","document","addEventListener","attachEvent","elem","nodeList","parentNode","querySelectorAll","anchor","callback","timeout","targetAttr","cbResponse","getAttribute","defaultPrevented","returnValue","preventDefault","metaKey","href","location","setTimeout","form","submit","deepExtend","Array","j","indexOf","prop","clone","undefined","input","JSON","parse","stringify","extendEvent","eventCollection","eventModifier","handleValidationError","call","extendEvents","eventsModifier","message","err","getExtendedEventBody","result","modifierResult","recordEvent","eventBody","asyncMode","url","data","cb","getRequestUrl","getRequestUrlOkLength","extendedEventBody","isAsync","encodeURIComponent","checkValidation","extend","Keen","enabled","api_key","base64","encode","modified","Date","getTime","getUrlMaxLength","requestType","sendXhr","sendBeacon","attemptPostXhr","sendJSONp","sendSynchronousXhr","recordEvents","eventsHash","extendedEventsHash","collection","body","index","eventList","getXhr","addEvent","addEvents","projectId","navigator","userAgent","appVersion","noXhrError","method","payload","xhr","onreadystatechange","response","readyState","status","responseText","open","setRequestHeader","toUpperCase","send","root","XMLHttpRequest","protocol","ActiveXObject","timestamp","script","createElement","parent","getElementsByTagName","callbackName","loaded","cleanup","src","appendChild","handleError","onerror","removeChild","img","onload","naturalHeight","naturalWidth","width","height","deferEvent","deferEvents","concat","queueCapacity","num","Number","queueInterval","clonedQueueConfig","clonedQueueEvents","res","initAutoTrackingCore","lib","obj","utils","options","ignoreDisabledFormFields","ignoreFormFieldTypes","recordClicks","recordFormSubmits","recordPageViews","recordScrollState","shareUuidAcrossDomains","now","cookie","uuid","get","getUniqueId","domainName","getDomainName","hostname","cookieDomain","domain","set","scrollState","getScrollState","browserProfile","getBrowserProfile","tracked_by","pkg","name","version","local_time_full","user","page","title","description","time_on_page","getSecondsSinceDate","ip_address","geo","user_agent","tech","profile","full","info","referrer","time","local","utc","keen","toISOString","addons","ip","output","ua_string","date_time","el","element","getDomNodeProfile","scroll_state","serializerOptions","disabled","ignoreTypes","action","fields","serializeForm","date","diff","Math","round","getScreenProfile","keys","screen","orientation","innerWidth","innerHeight","getWindowProfile","html","documentElement","offsetHeight","offsetWidth","max","scrollHeight","clientHeight","ratio","availHeight","parseFloat","toFixed","availWidth","cookieEnabled","appCodeName","getDocumentDescription","language","appName","onLine","platform","querySelector","content","getDatetimeIndex","getHours","parseInt","getDay","getDate","getMonth","getFullYear","extractHostname","split","splitArr","arrLen","getDomNodePath","stack","sibCount","sibIndex","childNodes","sib","hasAttribute","id","unshift","toLowerCase","slice","join","class","className","node_name","text","type","x_position","offsetLeft","clientLeft","y_position","offsetTop","clientTop","state","pixel","pixel_max","ratio_max","getScrollOffset","getWindowHeight","getScrollableArea","pageYOffset","scrollTop","replace","c","r","random","v","toString","expires","Cookies","getJSON","value","expire","daysUntilExpire","remove","k_r_submitter","k_r_success_contrls","brackets","serializer","hash_serializer","str_serialize","elements","radio_store","Object","create","test","val","checked","empty","selectOptions","isSelectedOptions","option","allowedEmpty","hasValue","selected","parse_keys","string","prefix","children","RegExp","match","exec","hash_assign","shift","between","isArray","_values","isNaN","existing","count","clear","initAutoTracking","trackExternalLink","listenTo","listenerHash","jsEvent","timeoutCallback","currentTarget","triggered","win","trigger","elt","len","from","ceil","floor","extendLibrary"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;ACnEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,YAAY;AACzB;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC1BA;;AAEA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA;AACA;;;;;;;ACTA,gD;;;;;;ACAA,gD;;;;;;ACAA,gD;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,wBAAwB;AACrD,qBAAqB,oCAAoC;AACzD;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC,oCAAoC;AACpC,iCAAiC;AACjC;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7CA;;AAEO,SAAS,WAAT,GAAiB;AACtB,MAAI,gBAAgB,WAAhB,KAA0B,KAA9B,EAAqC;AACnC,WAAO,IAAI,WAAJ,EAAP;AACD;AACD,OAAKA,QAAL,GAAgB,CAAhB;AACA,OAAKC,MAAL,GAAc;AACZD,cAAU,IADE;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","file":"node/keen-tracking.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"keen-core\"), require(\"js-cookie\"), require(\"component-emitter\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"keen-core\", \"js-cookie\", \"component-emitter\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"keen-core\"), require(\"js-cookie\"), require(\"component-emitter\")) : factory(root[\"keen-core\"], root[\"js-cookie\"], root[\"component-emitter\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(global, function(__WEBPACK_EXTERNAL_MODULE__2__, __WEBPACK_EXTERNAL_MODULE__3__, __WEBPACK_EXTERNAL_MODULE__4__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","module.exports = each;\n\nfunction each(o, cb, s){\n  var n;\n  if (!o){\n    return 0;\n  }\n  s = !s ? o : s;\n  if (o instanceof Array){\n    // Indexed arrays, needed for Safari\n    for (n=0; n<o.length; n++) {\n      if (cb.call(s, o[n], n, o) === false){\n        return 0;\n      }\n    }\n  } else {\n    // Hashtables\n    for (n in o){\n      if (o.hasOwnProperty(n)) {\n        if (cb.call(s, o[n], n, o) === false){\n          return 0;\n        }\n      }\n    }\n  }\n  return 1;\n}\n","module.exports = extend;\n\nfunction extend(target){\n  for (var i = 1; i < arguments.length; i++) {\n    for (var prop in arguments[i]){\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = __WEBPACK_EXTERNAL_MODULE__3__;","module.exports = __WEBPACK_EXTERNAL_MODULE__4__;","module.exports = {\n  map: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n  encode: function (n) {\n    \"use strict\";\n    var o = \"\", i = 0, m = this.map, i1, i2, i3, e1, e2, e3, e4;\n    n = this.utf8.encode(n);\n    while (i < n.length) {\n      i1 = n.charCodeAt(i++); i2 = n.charCodeAt(i++); i3 = n.charCodeAt(i++);\n      e1 = (i1 >> 2); e2 = (((i1 & 3) << 4) | (i2 >> 4)); e3 = (isNaN(i2) ? 64 : ((i2 & 15) << 2) | (i3 >> 6));\n      e4 = (isNaN(i2) || isNaN(i3)) ? 64 : i3 & 63;\n      o = o + m.charAt(e1) + m.charAt(e2) + m.charAt(e3) + m.charAt(e4);\n    } return o;\n  },\n  decode: function (n) {\n    \"use strict\";\n    var o = \"\", i = 0, m = this.map, cc = String.fromCharCode, e1, e2, e3, e4, c1, c2, c3;\n    n = n.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n    while (i < n.length) {\n      e1 = m.indexOf(n.charAt(i++)); e2 = m.indexOf(n.charAt(i++));\n      e3 = m.indexOf(n.charAt(i++)); e4 = m.indexOf(n.charAt(i++));\n      c1 = (e1 << 2) | (e2 >> 4); c2 = ((e2 & 15) << 4) | (e3 >> 2);\n      c3 = ((e3 & 3) << 6) | e4;\n      o = o + (cc(c1) + ((e3 != 64) ? cc(c2) : \"\")) + (((e4 != 64) ? cc(c3) : \"\"));\n    } return this.utf8.decode(o);\n  },\n  utf8: {\n    encode: function (n) {\n      \"use strict\";\n      var o = \"\", i = 0, cc = String.fromCharCode, c;\n      while (i < n.length) {\n        c = n.charCodeAt(i++); o = o + ((c < 128) ? cc(c) : ((c > 127) && (c < 2048)) ?\n        (cc((c >> 6) | 192) + cc((c & 63) | 128)) : (cc((c >> 12) | 224) + cc(((c >> 6) & 63) | 128) + cc((c & 63) | 128)));\n        } return o;\n    },\n    decode: function (n) {\n      \"use strict\";\n      var o = \"\", i = 0, cc = String.fromCharCode, c2, c;\n      while (i < n.length) {\n        c = n.charCodeAt(i);\n        o = o + ((c < 128) ? [cc(c), i++][0] : ((c > 191) && (c < 224)) ?\n        [cc(((c & 31) << 6) | ((c2 = n.charCodeAt(i + 1)) & 63)), (i += 2)][0] :\n        [cc(((c & 15) << 12) | (((c2 = n.charCodeAt(i + 1)) & 63) << 6) | ((c3 = n.charCodeAt(i + 2)) & 63)), (i += 3)][0]);\n      } return o;\n    }\n  }\n};\n","import Emitter from 'component-emitter';\n\nexport function queue() {\n  if (this instanceof queue === false) {\n    return new queue();\n  }\n  this.capacity = 0;\n  this.config = {\n    capacity: 5000,\n    interval: 15\n  };\n  this.events = {\n    // \"collection-1\": [],\n    // \"collection-2\": []\n  };\n  this.interval = 0;\n  this.timer = null;\n  return this;\n}\n\nEmitter(queue.prototype);\n\nqueue.prototype.check = function() {\n  if (shouldFlushQueue(this)) {\n    this.flush();\n  }\n  if (this.config.interval === 0 || this.capacity === 0) {\n    this.pause();\n  }\n  return this;\n};\n\nqueue.prototype.flush = function() {\n  this.emit('flush');\n  this.interval = 0;\n  return this;\n};\n\nqueue.prototype.pause = function() {\n  if (this.timer) {\n    clearInterval(this.timer);\n    this.timer = null;\n  }\n  return this;\n};\n\nqueue.prototype.start = function() {\n  var self = this;\n  self.pause();\n  self.timer = setInterval(function() {\n    self.interval++;\n    self.check();\n  }, 1000);\n  return self;\n};\n\nfunction shouldFlushQueue(props) {\n  if (props.capacity > 0 && props.interval >= props.config.interval) {\n    return true;\n  }\n  else if (props.capacity >= props.config.capacity) {\n    return true;\n  }\n  return false;\n}\n","import KeenCore from 'keen-core';\nimport each from 'keen-core/lib/utils/each';\nimport extend from 'keen-core/lib/utils/extend';\nimport { queue } from'./utils/queue';\n\nKeenCore.helpers = KeenCore.helpers || {};\n\n// Install internal queue\nKeenCore.on('client', function(client){\n  client.extensions = {\n    events: [],\n    collections: {}\n  };\n  client.queue = queue();\n  client.queue.on('flush', function(){\n    client.recordDeferredEvents();\n  });\n});\n\n// Accessors\nKeenCore.prototype.writeKey = function(str){\n  if (!arguments.length) return this.config.writeKey;\n  this.config.writeKey = (str ? String(str) : null);\n  return this;\n};\n\n// DEPRECATED\nKeenCore.prototype.setGlobalProperties = function(props){\n  KeenCore.log('This method has been deprecated. Check out #extendEvents: https://github.com/keen/keen-tracking.js#extend-events');\n  if (!props || typeof props !== 'function') {\n    this.emit('error', 'Invalid value for global properties: ' + props);\n    return;\n  }\n  this.config.globalProperties = props;\n  return this;\n};\n\nexport default KeenCore;\n","import Emitter from 'component-emitter';\nimport each from 'keen-core/lib/utils/each';\n/*\n\n  // Create a new element listner\n  var myClickerCatcher = Keen.utils.listener(\".nav li > a\");\n\n  // Listen for a given event\n  myClicker.on(\"click\", function(e){\n    // do stuff!\n  });\n\n  // Listen for event once\n  myClicker.once(\"click\", function(e){ });\n\n  // Cancel a given event listener\n  myClicker.off(\"click\");\n\n  // Cancel all event listners\n  myClicker.off();\n\n*/\n\nexport const listenerCore = function(ctx){\n\n  // Make sure this object exists\n  ctx.domListeners = ctx.domListeners || {\n    /*\n    'click': {\n      '.nav li > a': [fn, fn, fn]\n    }\n    */\n  };\n\n  function listener(str){\n    if (!str) return;\n    if (this instanceof listener === false) {\n      return new listener(str);\n    }\n    this.selector = str;\n    return this;\n  }\n\n  listener.prototype.on = function(str, fn){\n    var self = this;\n\n    if (arguments.length !== 2 || 'string' !== typeof str || 'function' !== typeof fn) return this;\n\n    // Set each listener on a parent dictionary, indexed by event:\n    if ('undefined' === typeof ctx.domListeners[str]) {\n      addListener(str, eventHandler(str));\n      ctx.domListeners[str] = {};\n    }\n    ctx.domListeners[str][self.selector] = ctx.domListeners[str][self.selector] || [];\n    ctx.domListeners[str][self.selector].push(fn);\n    return self;\n  };\n\n  listener.prototype.once = function(str, fn){\n    var self = this;\n    function on() {\n      self.off(str, on);\n      return fn.apply(self, arguments);\n    }\n    on.fn = fn;\n    self.on(str, on);\n    return self;\n  };\n\n  listener.prototype.off = function(str, fn){\n    var self = this, survivors = [];\n    if (arguments.length === 2) {\n      each(ctx.domListeners[str][self.selector], function(handler, i){\n        if (handler === fn || handler.fn === fn) return;\n        survivors.push(handler);\n      });\n      ctx.domListeners[str][self.selector] = survivors;\n    }\n    else if (arguments.length === 1) {\n      try {\n        delete ctx.domListeners[str][self.selector];\n      }\n      catch(e){\n        ctx.domListeners[str][self.selector] = [];\n      }\n    }\n    else {\n      // loop over every eventType and delete handlers\n      each(ctx.domListeners, function(hash, eventType){\n        // if ('undefined' === typeof hash[str]) return;\n        try {\n          delete ctx.domListeners[eventType][self.selector];\n        }\n        catch(e){\n          ctx.domListeners[eventType][self.selector] = function(){};\n        }\n      });\n    }\n    return self;\n  };\n\n  function eventHandler(eventType){\n    return function(e){\n      var evt, target;\n\n      evt = e || window.event;\n      target = evt.target || evt.srcElement;\n\n      // If nothing assigned to this event type, let it go\n      if ('undefined' === ctx.domListeners[eventType]) return;\n\n      each(ctx.domListeners[eventType], function(handlers, key){\n\n        if (matches(target, key)) {\n          // Call all handlers for this eventType + node\n          each(handlers, function(fn, i){\n            if ('click' === eventType && 'A' === target.nodeName) {\n              deferClickEvent(evt, target, fn);\n            }\n            else if ('submit' === eventType && 'FORM' === target.nodeName) {\n              deferFormSubmit(evt, target, fn);\n            }\n            else {\n              fn(evt);\n            }\n          });\n        }\n        else if ('window' === key) {\n          // Call all handlers\n          each(handlers, function(fn, i){\n            fn(evt);\n          });\n        }\n        return;\n      });\n    };\n  }\n\n  return listener;\n}\n\n\n// ------------------------------\n// Attach global event listener\n// ------------------------------\n\nfunction addListener(eventType, fn){\n  if (document.addEventListener) {\n    document.addEventListener(eventType, fn, false);\n  } else {\n    document.attachEvent(\"on\" + eventType, fn);\n  }\n}\n\n\n// ------------------------------\n// Match DOM element to selector\n// ------------------------------\n\nfunction matches(elem, selector) {\n  // We'll use querySelectorAll to find all element matching the selector,\n  // then check if the given element is included in that list.\n  // Executing the query on the parentNode reduces the resulting nodeList,\n  // document doesn't have a parentNode, though.\n  var nodeList = ( elem.parentNode || document ).querySelectorAll( selector ) || [],\n      i = nodeList.length;\n\n  // loop on the nodeList\n  while ( i-- ) {\n    if ( nodeList[i] == elem ) { return true; }\n  }\n  return false;\n}\n\n\n// ------------------------------\n// Handle 'click' events (A)\n// ------------------------------\n\nfunction deferClickEvent(evt, anchor, callback){\n  var timeout = 500,\n      targetAttr,\n      cbResponse;\n\n  // Get 'target' attribute from anchor\n  if (anchor.getAttribute !== void 0) {\n    targetAttr = anchor.getAttribute(\"target\");\n  } else if (anchor.target) {\n    targetAttr = anchor.target;\n  }\n\n  // Fire listener and catch possible response (return false)\n  cbResponse = callback(evt);\n\n  // If prevented within callback, bail:\n  if (('boolean' === typeof cbResponse && cbResponse === false) || evt.defaultPrevented || evt.returnValue === false) {\n    if (evt.preventDefault) {\n      evt.preventDefault();\n    }\n    evt.returnValue = false;\n    return false;\n  }\n  // Else if anchor doesn't kick off a new window or tab.. defer and replay the event:\n  else if (targetAttr !== '_blank' && targetAttr !== 'blank' && !evt.metaKey) {\n    if (evt.preventDefault) {\n      evt.preventDefault();\n    }\n    evt.returnValue = false;\n    if (\n      anchor.href\n      && anchor.href !== '#'\n      && anchor.href !== (window.location + '#')\n    ) {\n      setTimeout(function(){\n        window.location = anchor.href;\n      }, timeout);\n    }\n  }\n\n  return false;\n}\n\n\n// ------------------------------\n// Handle 'submit' events (FORM)\n// ------------------------------\n\nfunction deferFormSubmit(evt, form, callback){\n  var timeout = 500;\n\n  // Fire listener and catch possible response (return false)\n  var cbResponse = callback(evt);\n\n  // If prevented within callback, bail\n  if (('boolean' === typeof cbResponse && cbResponse === false) || evt.defaultPrevented || evt.returnValue === false) {\n    if (evt.preventDefault) {\n      evt.preventDefault();\n    }\n    evt.returnValue = false;\n    return false;\n  }\n  // Defer and replay event\n  else {\n    if (evt.preventDefault) {\n      evt.preventDefault();\n    }\n    evt.returnValue = false;\n    setTimeout(function(){\n      form.submit();\n    }, timeout);\n  }\n\n  return false;\n}\n","export const deepExtend = function(target){\n  for (var i = 1; i < arguments.length; i++) {\n    // Copy unique items from incoming array\n    if (target instanceof Array && arguments[i] instanceof Array) {\n      for (var j = 0; j < arguments[i].length; j++) {\n        if (target.indexOf(arguments[i][j]) < 0) {\n          target.push(arguments[i][j]);\n        }\n      }\n    }\n    // Blend objects\n    else {\n      for (var prop in arguments[i]){\n        // Recurse when both contain objects of same name\n        // and incoming is not a null object\n        if (typeof target[prop] !== 'undefined'\n          && typeof arguments[i][prop] === 'object'\n          && arguments[i][prop] !== null) {\n            deepExtend(target[prop], clone(arguments[i][prop]));\n        }\n        // Otherwise just copy it over...\n        else if (\n          arguments[i][prop] !== undefined &&\n          typeof arguments[i][prop] !== 'function') {\n            target[prop] = clone(arguments[i][prop]);\n        }\n      }\n    }\n  }\n  return target;\n}\n\nfunction clone(input){\n  return JSON.parse( JSON.stringify(input) );\n}\n","import { deepExtend } from './utils/deepExtend';\nimport each from 'keen-core/lib/utils/each';\n\nexport function extendEvent(eventCollection, eventModifier){\n  if (arguments.length !== 2 || typeof eventCollection !== 'string'\n    || ('object' !== typeof eventModifier && 'function' !== typeof eventModifier)) {\n      handleValidationError.call(this, 'Incorrect arguments provided to #extendEvent method');\n      return;\n  }\n  this.extensions.collections[eventCollection] = this.extensions.collections[eventCollection] || [];\n  this.extensions.collections[eventCollection].push(eventModifier);\n  this.emit('extendEvent', eventCollection, eventModifier);\n  return this;\n}\n\nexport function extendEvents(eventsModifier){\n  if (arguments.length !== 1 || ('object' !== typeof eventsModifier && 'function' !== typeof eventsModifier)) {\n    handleValidationError.call(this, 'Incorrect arguments provided to #extendEvents method');\n    return;\n  }\n  this.extensions.events.push(eventsModifier);\n  this.emit('extendEvents', eventsModifier);\n  return this;\n}\n\nfunction handleValidationError(message){\n  var err = 'Event(s) not extended: ' + message;\n  this.emit('error', err);\n}\n\nexport function getExtendedEventBody(result, queue){\n  if (queue && queue.length > 0) {\n    each(queue, function(eventModifier, i){\n      var modifierResult = (typeof eventModifier === 'function') ? eventModifier() : eventModifier;\n      deepExtend(result, modifierResult);\n    });\n  }\n  return result;\n}\n","import Keen from './index';\nimport base64 from 'keen-core/lib/utils/base64';\nimport each from 'keen-core/lib/utils/each';\nimport extend from 'keen-core/lib/utils/extend';\nimport { getExtendedEventBody } from './extend-events';\n\n// ------------------------------\n// .recordEvent\n// ------------------------------\n\nexport function recordEvent(eventCollection, eventBody, callback, asyncMode){\n  var url, data, cb, getRequestUrl, getRequestUrlOkLength, extendedEventBody, isAsync;\n\n  url = this.url('events', encodeURIComponent(eventCollection));\n  data = {};\n  cb = callback;\n\n  // Requests are asynchronous by default\n  isAsync = ('boolean' === typeof asyncMode) ? asyncMode : true;\n\n  if (!checkValidation.call(this, cb)) {\n    return;\n  }\n\n  if (!eventCollection || typeof eventCollection !== 'string') {\n    handleValidationError.call(this, 'Collection name must be a string.', cb);\n    return;\n  }\n\n  // ------------------------------\n  // DEPRECATED\n  // Apply client.globalProperties\n  // ------------------------------\n  if (this.config.globalProperties) {\n    data = this.config.globalProperties(eventCollection);\n  }\n  extend(data, eventBody);\n\n  // ------------------------------\n  // Run extendEvent(s) transforms\n  // ------------------------------\n  extendedEventBody = {};\n  getExtendedEventBody(extendedEventBody, this.extensions.events);\n  getExtendedEventBody(extendedEventBody, this.extensions.collections[eventCollection]);\n  getExtendedEventBody(extendedEventBody, [data]);\n\n  this.emit('recordEvent', eventCollection, extendedEventBody);\n\n  if (!Keen.enabled) {\n    handleValidationError.call(this, 'Keen.enabled is set to false.', cb);\n    return false;\n  }\n\n  // ------------------------------\n  // Send event\n  // ------------------------------\n\n  getRequestUrl = this.url('events', encodeURIComponent(eventCollection), {\n    api_key  : this.writeKey(),\n    data     : encodeURIComponent( base64.encode( JSON.stringify(extendedEventBody) ) ),\n    modified : new Date().getTime()\n  });\n  getRequestUrlOkLength = getRequestUrl.length < getUrlMaxLength();\n\n  if (isAsync) {\n    switch (this.config.requestType) {\n      case 'xhr':\n        sendXhr.call(this, 'POST', url, extendedEventBody, cb);\n        break;\n      case 'beacon':\n        if (getRequestUrlOkLength) {\n          sendBeacon.call(this, getRequestUrl, cb);\n        }\n        else {\n          attemptPostXhr.call(this, url, extendedEventBody,\n              'Beacon URL length exceeds current browser limit, and XHR is not supported.', cb)\n        }\n        break;\n      default:\n        if (getRequestUrlOkLength) {\n          sendJSONp.call(this, getRequestUrl, cb);\n        }\n        else {\n          attemptPostXhr.call(this, url, extendedEventBody,\n              'JSONp URL length exceeds current browser limit, and XHR is not supported.', cb)\n        }\n        break;\n    }\n  }\n  else {\n    // Send synchronous request\n    if (getRequestUrlOkLength) {\n      sendSynchronousXhr(getRequestUrl);\n    }\n  }\n\n  callback = cb = null;\n  return this;\n}\n\n// ------------------------------\n// .recordEvents\n// ------------------------------\n\nexport function recordEvents(eventsHash, callback){\n  var self = this, url, cb, extendedEventsHash;\n\n  url = this.url('events');\n  cb = callback;\n  callback = null;\n\n  if (!checkValidation.call(this, cb)) {\n    return;\n  }\n\n  if ('object' !== typeof eventsHash || eventsHash instanceof Array) {\n    handleValidationError.call(this, 'First argument must be an object', cb);\n    return;\n  }\n\n  if (arguments.length > 2) {\n    handleValidationError.call(this, 'Incorrect arguments provided to #recordEvents method', cb);\n    return;\n  }\n\n  // ------------------------------\n  // DEPRECATED\n  // Apply client.globalProperties\n  // ------------------------------\n  if (this.config.globalProperties) {\n    // Loop over each set of events\n    each(eventsHash, function(events, collection){\n      // Loop over each individual event\n      each(events, function(body, index){\n        // Start with global properties for this collection\n        var modified = self.config.globalProperties(collection);\n        // Apply provided properties for this event body\n        eventsHash[collection][index] = extend(modified, body);\n      });\n    });\n  }\n\n  // ------------------------------\n  // Run extendEvent(s) transforms\n  // ------------------------------\n  extendedEventsHash = {};\n  each(eventsHash, function(eventList, eventCollection){\n    // Find or create collection on new hash\n    extendedEventsHash[eventCollection] = extendedEventsHash[eventCollection] || [];\n    // Loop over each eventBody in the existing hash\n    each(eventList, function(eventBody, index){\n      // Create a new data object\n      var extendedEventBody = {};\n      // Process \"events\" transform pipeline\n      getExtendedEventBody(extendedEventBody, self.extensions.events);\n      // Process \"collection\" transform pipeline\n      getExtendedEventBody(extendedEventBody, self.extensions.collections[eventCollection]);\n      // Blend existing eventBody data into the result\n      getExtendedEventBody(extendedEventBody, [eventBody]);\n      // Push extendedEventBody into new hash\n      extendedEventsHash[eventCollection].push(extendedEventBody);\n    });\n  });\n\n  this.emit('recordEvents', extendedEventsHash);\n\n  if (!Keen.enabled) {\n    handleValidationError.call(this, 'Keen.enabled is set to false.', cb);\n    return false;\n  }\n\n  if (getXhr()) {\n    sendXhr.call(this, 'POST', url, extendedEventsHash, cb);\n  }\n  else {\n    // each(eventsHash, function(eventArray, eventCollection){\n    //    ... send each individually?\n    // });\n  }\n\n  callback = cb = null;\n  return this;\n}\n\n\n// ----------------------\n// DEPRECATED\n// ----------------------\n\nexport function addEvent(){\n  this.emit('error', 'This method has been deprecated. Check out #recordEvent: https://github.com/keen/keen-tracking.js#record-a-single-event');\n  recordEvent.apply(this, arguments);\n}\n\nexport function addEvents(){\n  this.emit('error', 'This method has been deprecated. Check out #recordEvents: https://github.com/keen/keen-tracking.js#record-multiple-events');\n  recordEvents.apply(this, arguments);\n}\n\n\n// ------------------------------\n// Validation\n// ------------------------------\n\nfunction checkValidation(callback){\n  var cb = callback;\n  callback = null;\n\n  if (!this.projectId()) {\n    handleValidationError.call(this, 'Keen.Client is missing a projectId property.', cb);\n    return false;\n  }\n  if (!this.writeKey()) {\n    handleValidationError.call(this, 'Keen.Client is missing a writeKey property.', cb);\n    return false;\n  }\n  return true;\n}\n\nfunction handleValidationError(message, cb){\n  var err = 'Event(s) not recorded: ' + message;\n  this.emit('error', err);\n  if (cb) {\n    cb.call(this, err, null);\n    cb = null;\n  }\n}\n\nfunction getUrlMaxLength(){\n  if ('undefined' !== typeof window && navigator) {\n    if (navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') > 0) {\n      return 2000;\n    }\n  }\n  return 16000;\n}\n\n\n// ------------------------------\n// XHR Requests\n// ------------------------------\n\nfunction attemptPostXhr(url, data, noXhrError, callback) {\n  if (getXhr()) {\n    sendXhr.call(this, 'POST', url, data, callback);\n  }\n  else {\n    handleValidationError.call(this, noXhrError);\n  }\n}\n\nfunction sendXhr(method, url, data, callback){\n  var self = this;\n  var payload;\n  var xhr = getXhr();\n  var cb = callback;\n  callback = null;\n\n  xhr.onreadystatechange = function() {\n    var response;\n    if (xhr.readyState == 4) {\n      if (xhr.status >= 200 && xhr.status < 300) {\n        try {\n          response = JSON.parse( xhr.responseText );\n        } catch (e) {\n          Keen.emit('error', 'Could not parse HTTP response: ' + xhr.responseText);\n          if (cb) {\n            cb.call(self, xhr, null);\n          }\n        }\n        if (cb && response) {\n          cb.call(self, null, response);\n        }\n      }\n      else {\n        Keen.emit('error', 'HTTP request failed.');\n        if (cb) {\n          cb.call(self, xhr, null);\n        }\n      }\n    }\n  };\n\n  xhr.open(method, url, true);\n  xhr.setRequestHeader('Authorization', self.writeKey());\n  xhr.setRequestHeader('Content-Type', 'application/json');\n\n  if (data) {\n    payload = JSON.stringify(data);\n  }\n\n  if (method.toUpperCase() === 'GET') {\n    xhr.send();\n  }\n  if (method.toUpperCase() === 'POST') {\n    xhr.send(payload);\n  }\n\n}\n\nfunction sendSynchronousXhr(url){\n  var xhr = getXhr();\n  if (xhr) {\n    xhr.open('GET', url, false);\n    xhr.send(null);\n  }\n}\n\nfunction getXhr() {\n  // yay, superagent!\n  var root = 'undefined' == typeof window ? this : window;\n  if (root.XMLHttpRequest && ('file:' != root.location.protocol || !root.ActiveXObject)) {\n    return new XMLHttpRequest;\n  } else {\n    try { return new ActiveXObject('Microsoft.XMLHTTP'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP.6.0'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP.3.0'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP'); } catch(e) {}\n  }\n  return false;\n};\n\n\n// ------------------------------\n// JSON-P Requests\n// ------------------------------\n\nfunction sendJSONp(url, callback){\n  var self = this,\n      cb = callback,\n      timestamp = new Date().getTime(),\n      script = document.createElement('script'),\n      parent = document.getElementsByTagName('head')[0],\n      callbackName = 'keenJSONPCallback',\n      loaded = false;\n\n  callback = null;\n\n  callbackName += timestamp;\n  while (callbackName in window) {\n    callbackName += 'a';\n  }\n  window[callbackName] = function(response) {\n    if (loaded === true) return;\n    loaded = true;\n    if (cb) {\n      cb.call(self, null, response);\n    }\n    cleanup();\n  };\n  script.src = url + '&jsonp=' + callbackName;\n  parent.appendChild(script);\n\n  // for early IE w/ no onerror event\n  script.onreadystatechange = function() {\n    if (loaded === false && this.readyState === 'loaded') {\n      loaded = true;\n      handleError();\n      cleanup();\n    }\n  };\n  // non-ie, etc\n  script.onerror = function() {\n    // on IE9 both onerror and onreadystatechange are called\n    if (loaded === false) {\n      loaded = true;\n      handleError();\n      cleanup();\n    }\n  };\n\n  function handleError(){\n    if (cb) {\n      cb.call(self, 'An error occurred!', null);\n    }\n  }\n\n  function cleanup(){\n    window[callbackName] = undefined;\n    try {\n      delete window[callbackName];\n    } catch(e){};\n    parent.removeChild(script);\n  }\n\n}\n\n\n// ------------------------------\n// Image Beacon Requests\n// ------------------------------\n\nfunction sendBeacon(url, callback){\n  var self = this,\n      cb = callback,\n      img = document.createElement('img'),\n      loaded = false;\n\n  callback = null;\n\n  img.onload = function() {\n    loaded = true;\n    if ('naturalHeight' in this) {\n      if (this.naturalHeight + this.naturalWidth === 0) {\n        this.onerror();\n        return;\n      }\n    } else if (this.width + this.height === 0) {\n      this.onerror();\n      return;\n    }\n    if (cb) {\n      cb.call(self);\n    }\n  };\n  img.onerror = function() {\n    loaded = true;\n    if (cb) {\n      cb.call(self, 'An error occurred!', null);\n    }\n  };\n  img.src = url + '&c=clv1';\n}\n","import Keen from './index';\nimport each from 'keen-core/lib/utils/each';\nimport { queue } from './utils/queue';\n\nexport function deferEvent(eventCollection, eventBody){\n\n  if (arguments.length !== 2 || typeof eventCollection !== 'string') {\n    handleValidationError.call(this, 'Incorrect arguments provided to #deferEvent method');\n    return;\n  }\n\n  this.queue.events[eventCollection] = this.queue.events[eventCollection] || [];\n  this.queue.events[eventCollection].push(eventBody);\n  this.queue.capacity++;\n  if (!this.queue.timer) {\n    this.queue.start();\n  }\n  this.emit('deferEvent', eventCollection, eventBody);\n  return this;\n}\n\nexport function deferEvents(eventsHash){\n  var self = this;\n\n  if (arguments.length !== 1 || typeof eventsHash !== 'object') {\n    handleValidationError.call(this, 'Incorrect arguments provided to #deferEvents method');\n    return;\n  }\n\n  each(eventsHash, function(eventList, eventCollection){\n    self.queue.events[eventCollection] = self.queue.events[eventCollection] || [];\n    self.queue.events[eventCollection] = self.queue.events[eventCollection].concat(eventList);\n    self.queue.capacity = self.queue.capacity + eventList.length;\n    if (!self.queue.timer) {\n      self.queue.start();\n    }\n  });\n  self.emit('deferEvents', eventsHash);\n  return self;\n}\n\nexport function queueCapacity(num){\n  if (!arguments.length) return this.queue.config.capacity;\n  this.queue.config.capacity = num ? Number(num): 0;\n  this.queue.check();\n  return this;\n}\n\nexport function queueInterval(num){\n  if (!arguments.length) return this.queue.config.interval;\n  this.queue.config.interval = num ? Number(num): 0;\n  this.queue.check();\n  return this;\n}\n\nexport function recordDeferredEvents(){\n  var self = this,\n      clonedQueueConfig,\n      clonedQueueEvents;\n\n  if (self.queue.capacity > 0) {\n    self.queue.pause();\n    clonedQueueConfig = JSON.parse(JSON.stringify(self.queue.config));\n    clonedQueueEvents = JSON.parse(JSON.stringify(self.queue.events));\n    self.queue = queue();\n    self.queue.config = clonedQueueConfig;\n    self.queue.on('flush', function(){\n      self.recordDeferredEvents();\n    });\n    self.emit('recordDeferredEvents', clonedQueueEvents);\n    self.recordEvents(clonedQueueEvents, function(err, res){\n      if (err) {\n        // Retry once\n        self.recordEvents(clonedQueueEvents);\n      }\n      else {\n        clonedQueueEvents = undefined;\n      }\n    });\n  }\n  return self;\n}\n\nfunction handleValidationError(message){\n  var err = 'Event(s) not deferred: ' + message;\n  this.emit('error', err);\n}\n","import pkg from '../package.json';\n\nexport function initAutoTrackingCore(lib) {\n  return function(obj) {\n    var client = this;\n    var helpers = lib.helpers;\n    var utils = lib.utils;\n\n    var options = utils.extend({\n      ignoreDisabledFormFields: false,\n      ignoreFormFieldTypes: ['password'],\n      recordClicks: true,\n      recordFormSubmits: true,\n      recordPageViews: true,\n      recordScrollState: true,\n      shareUuidAcrossDomains: false\n    }, obj);\n\n    var now = new Date();\n\n    var cookie = new utils.cookie('keen');\n    var uuid = cookie.get('uuid');\n    if (!uuid) {\n      uuid = helpers.getUniqueId();\n      var domainName = helpers.getDomainName(window.location.hostname);\n      var cookieDomain = domainName && options.shareUuidAcrossDomains ? {\n        domain: '.' + domainName\n      } : {};\n      cookie.set('uuid', uuid, cookieDomain);\n    }\n\n    var scrollState = {};\n    if (options.recordScrollState) {\n      scrollState = helpers.getScrollState();\n      utils.listener('window').on('scroll', function(){\n        scrollState = helpers.getScrollState(scrollState);\n      });\n    }\n\n    client.extendEvents(function() {\n      var browserProfile = helpers.getBrowserProfile();\n      return {\n        tracked_by: pkg.name + '-' + pkg.version,\n        local_time_full: new Date(),\n        user: {\n          uuid: uuid\n        },\n        page: {\n          title: document ? document.title : null,\n          description: browserProfile.description,\n          time_on_page: getSecondsSinceDate(now)\n        },\n\n        ip_address: '${keen.ip}',\n        geo: { /* Enriched */ },\n\n        user_agent: '${keen.user_agent}',\n        tech: {\n          profile: browserProfile\n          /* Enriched */\n        },\n\n        url: {\n          full: window ? window.location.href : '',\n          info: { /* Enriched */ }\n        },\n\n        referrer: {\n          full: document ? document.referrer : '',\n          info: { /* Enriched */ }\n        },\n\n        time: {\n          local: { /* Enriched */ },\n          utc: { /* Enriched */ }\n        },\n\n        keen: {\n          timestamp: new Date().toISOString(),\n          addons: [\n            {\n              name: 'keen:ip_to_geo',\n              input: {\n                ip: 'ip_address'\n              },\n              output : 'geo'\n            },\n            {\n              name: 'keen:ua_parser',\n              input: {\n                ua_string: 'user_agent'\n              },\n              output: 'tech'\n            },\n            {\n              name: 'keen:url_parser',\n              input: {\n                url: 'url.full'\n              },\n              output: 'url.info'\n            },\n            {\n              name: 'keen:url_parser',\n              input: {\n                url: 'referrer.full'\n              },\n              output: 'referrer.info'\n            },\n            {\n              name: 'keen:date_time_parser',\n              input: {\n                date_time: 'keen.timestamp'\n              },\n              output: 'time.utc'\n            },\n            {\n              name: 'keen:date_time_parser',\n              input: {\n                date_time: 'local_time_full'\n              },\n              output: 'time.local'\n            }\n          ],\n        }\n      };\n    });\n\n\n\n    if (options.recordClicks === true) {\n      utils.listener('a, a *').on('click', function(e) {\n        var el = e.target;\n        var props = {\n          element: helpers.getDomNodeProfile(el),\n          local_time_full: new Date(),\n          page: {\n            scroll_state: scrollState\n          }\n        };\n        client.recordEvent('clicks', props);\n      });\n    }\n\n    if (options.recordFormSubmits === true) {\n      utils.listener('form').on('submit', function(e) {\n        var el = e.target;\n        var serializerOptions = {\n          disabled: options.ignoreDisabledFormFields,\n          ignoreTypes: options.ignoreFormFieldTypes\n        };\n        var props = {\n          form: {\n            action: el.action,\n            fields: utils.serializeForm(el, serializerOptions),\n            method: el.method\n          },\n          element: helpers.getDomNodeProfile(el),\n          local_time_full: new Date(),\n          page: {\n            scroll_state: scrollState\n          }\n        };\n        client.recordEvent('form_submissions', props);\n      });\n    }\n\n    if (options.recordPageViews === true) {\n      client.recordEvent('pageviews');\n    }\n\n    return client;\n  };\n}\n\nfunction getSecondsSinceDate(date) {\n  var diff = new Date().getTime() - date.getTime();\n  return Math.round(diff / 1000);\n}\n","export function getScreenProfile(){\n  var keys, output;\n\n  if ('undefined' == typeof window || !window.screen) return {};\n\n  keys = ['height', 'width', 'colorDepth', 'pixelDepth', 'availHeight', 'availWidth'];\n  output = {};\n\n  for (var i = 0; i < keys.length; i++) {\n    output[keys[i]] = window.screen[keys[i]] ? window.screen[keys[i]] : null;\n  }\n\n  output.orientation = {\n    'angle' : window.screen.orientation ? window.screen.orientation['angle'] : 0,\n    'type'  : window.innerWidth > window.innerHeight ? 'landscape': 'portrait'\n  };\n\n  return output;\n}\n","export function getWindowProfile(){\n  var body, html, output;\n\n  if ('undefined' == typeof document) return {};\n\n  body = document.body;\n  html = document.documentElement;\n\n  output = {\n    'height': ('innerHeight' in window) ? window.innerHeight : document.documentElement.offsetHeight,\n    'width': ('innerWidth' in window) ? window.innerWidth : document.documentElement.offsetWidth,\n    'scrollHeight': Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight ) || null\n  };\n\n  if (window.screen) {\n    output.ratio = {\n      'height': (window.screen.availHeight) ? parseFloat( (window.innerHeight/window.screen.availHeight).toFixed(2) ) : null,\n      'width': (window.screen.availWidth) ? parseFloat( (window.innerWidth/window.screen.availWidth).toFixed(2) ) : null\n    };\n  }\n\n  return output;\n}\n\n/*\n  Notes:\n    document.documentElement.offsetHeight/Width is a workaround for IE8 and below, where window.innerHeight/Width is undefined\n*/\n","import { getScreenProfile } from './getScreenProfile';\nimport { getWindowProfile } from './getWindowProfile';\n\nexport function getBrowserProfile() {\n  return {\n    'cookies'    : ('undefined' !== typeof navigator.cookieEnabled) ? navigator.cookieEnabled : false,\n    'codeName'   : navigator.appCodeName,\n    'description': getDocumentDescription(),\n    'language'   : navigator.language,\n    'name'       : navigator.appName,\n    'online'     : navigator.onLine,\n    'platform'   : navigator.platform,\n    'useragent'  : navigator.userAgent,\n    'version'    : navigator.appVersion,\n    'screen'     : getScreenProfile(),\n    'window'     : getWindowProfile()\n  }\n}\n\nfunction getDocumentDescription() {\n  var el;\n  if (document && typeof document.querySelector === 'function') {\n    el = document.querySelector('meta[name=\"description\"]');\n  }\n  return el ? el.content : '';\n}\n","export function getDatetimeIndex(input){\n  var date = input || new Date();\n  return {\n    'hour_of_day'  : date.getHours(),\n    'day_of_week'  : parseInt( 1 + date.getDay() ),\n    'day_of_month' : date.getDate(),\n    'month'        : parseInt( 1 + date.getMonth() ),\n    'year'         : date.getFullYear()\n  };\n}\n","function extractHostname(url) {\n    var hostname;\n    //find & remove protocol (http, ftp, etc.) and get hostname\n\n    if (url.indexOf(\"://\") > -1) {\n        hostname = url.split('/')[2];\n    }\n    else {\n        hostname = url.split('/')[0];\n    }\n\n    //find & remove port number\n    hostname = hostname.split(':')[0];\n    //find & remove \"?\"\n    hostname = hostname.split('?')[0];\n\n    return hostname;\n}\n\n// To address those who want the \"root domain,\" use this function:\nexport function getDomainName(url) {\n    var domain = extractHostname(url),\n        splitArr = domain.split('.'),\n        arrLen = splitArr.length;\n\n    //extracting the root domain here\n    //if there is a subdomain\n    if (arrLen > 2) {\n        domain = splitArr[arrLen - 2] + '.' + splitArr[arrLen - 1];\n        //check to see if it's using a Country Code Top Level Domain (ccTLD) (i.e. \".me.uk\")\n        if (splitArr[arrLen - 2].length == 2 && splitArr[arrLen - 1].length == 2) {\n            //this is using a ccTLD\n            domain = splitArr[arrLen - 3] + '.' + domain;\n        }\n    }\n    return domain;\n}\n","export function getDomNodePath(el){\n  if (!el.nodeName) return '';\n\n  var stack = [];\n  while ( el.parentNode != null ) {\n    // console.log(el.nodeName);\n    var sibCount = 0;\n    var sibIndex = 0;\n    for ( var i = 0; i < el.parentNode.childNodes.length; i++ ) {\n      var sib = el.parentNode.childNodes[i];\n      if ( sib.nodeName == el.nodeName ) {\n        if ( sib === el ) {\n          sibIndex = sibCount;\n        }\n        sibCount++;\n      }\n    }\n    if ( el.hasAttribute('id') && el.id != '' ) {\n      stack.unshift(el.nodeName.toLowerCase() + '#' + el.id);\n    } else if ( sibCount > 1 ) {\n      stack.unshift(el.nodeName.toLowerCase() + ':eq(' + sibIndex + ')');\n    } else {\n      stack.unshift(el.nodeName.toLowerCase());\n    }\n    el = el.parentNode;\n  }\n\n  return stack.slice(1).join(' > ');\n}\n\n\n// via: http://stackoverflow.com/a/16742828/2511985\n","import { getDomNodePath } from './getDomNodePath';\n\nexport function getDomNodeProfile(el) {\n  return {\n    action: el.action,\n    class: el.className,\n    href: el.href || null,\n    id: el.id,\n    method: el.method,\n    name: el.name,\n    node_name: el.nodeName,\n    selector: getDomNodePath(el),\n    text: el.text,\n    title: el.title,\n    type: el.type,\n    x_position: el.offsetLeft || el.clientLeft || null,\n    y_position: el.offsetTop || el.clientTop || null\n  };\n}\n","import extend from 'keen-core/lib/utils/extend';\n\nexport function getScrollState(obj){\n  var config = typeof obj === 'object' ? obj : {};\n  var state = extend({\n    pixel: 0,\n    pixel_max: 0,\n    ratio: null,\n    ratio_max: null\n  }, config);\n\n  if (typeof window !== undefined || typeof document !== undefined) {\n    state.pixel = getScrollOffset() + getWindowHeight();\n    if (state.pixel > state.pixel_max) {\n      state.pixel_max = state.pixel;\n    }\n    state.ratio = parseFloat(Number(state.pixel / getScrollableArea()).toFixed(2));\n    state.ratio_max = parseFloat(Number(state.pixel_max / getScrollableArea()).toFixed(2));\n  }\n\n  return state;\n}\n\nfunction getScrollableArea() {\n  var body = document.body;\n  var html = document.documentElement;\n  return Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight ) || null;\n}\n\nfunction getScrollOffset() {\n  return (window.pageYOffset !== undefined) ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;\n}\n\nfunction getWindowHeight() {\n  return window.innerHeight || document.documentElement.clientHeight;\n}\n","// via: http://stackoverflow.com/a/2117523/2511985\n\nexport function getUniqueId(){\n  var str = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\n  return str.replace(/[xy]/g, function(c) {\n    var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n    return v.toString(16);\n  });\n}\n","import Cookies from 'js-cookie';\nimport extend from 'keen-core/lib/utils/extend';\n\nexport const cookie = function(str){\n  if (!arguments.length) return;\n  if (this instanceof cookie === false) {\n    return new cookie(str);\n  }\n\n  this.config = {\n    key: str,\n    options: {\n      expires: 365\n    }\n  };\n  this.data = this.get();\n  return this;\n}\n\ncookie.prototype.get = function(str){\n  var data = {};\n\n  if (Cookies.get(this.config.key)) {\n    data = Cookies.getJSON(this.config.key);\n  }\n  if (str && typeof data === 'object' && typeof data !== null) {\n    return (typeof data[str] !== 'undefined') ? data[str] : null;\n  }\n  else {\n    return data;\n  }\n};\n\ncookie.prototype.set = function(str, value, options){\n  if (!arguments.length || !this.enabled()) return this;\n  if (typeof str === 'string' && arguments.length >= 2) {\n    this.data[str] = value ? value : null;\n  }\n  else if (typeof str === 'object' && arguments.length === 1) {\n    extend(this.data, str);\n  }\n  Cookies.set(\n    this.config.key,\n    this.data,\n    extend(this.config.options, options || {})\n  );\n  return this;\n};\n\ncookie.prototype.expire = function(daysUntilExpire){\n  if (daysUntilExpire) {\n    Cookies.set(\n      this.config.key,\n      this.data,\n      extend(this.config.options, { expires: daysUntilExpire })\n    );\n  } else {\n    Cookies.remove(this.config.key);\n    this.data = {};\n  }\n  return this;\n};\n\ncookie.prototype.options = function(obj){\n  if (!arguments.length) return this.config.options;\n  this.config.options = (typeof obj === 'object') ? obj : {};\n  return this;\n};\n\ncookie.prototype.enabled = function(){\n  return navigator.cookieEnabled;\n};\n","/*\n  This is a modified copy of https://github.com/defunctzombie/form-serialize/ v0.7.1\n  Includes a new configuration option:\n    * ignoreTypes - Array, Default: [], Example: [ 'password' ]\n*/\n\n// types which indicate a submit action and are not successful controls\n// these will be ignored\nvar k_r_submitter = /^(?:submit|button|image|reset|file)$/i;\n\n// node names which could be successful controls\nvar k_r_success_contrls = /^(?:input|select|textarea|keygen)/i;\n\n// Matches bracket notation.\nvar brackets = /(\\[[^\\[\\]]*\\])/g;\n\n// serializes form fields\n// @param form MUST be an HTMLForm element\n// @param options is an optional argument to configure the serialization. Default output\n// with no options specified is a url encoded string\n//    - hash: [true | false] Configure the output type. If true, the output will\n//    be a js object.\n//    - serializer: [function] Optional serializer function to override the default one.\n//    The function takes 3 arguments (result, key, value) and should return new result\n//    hash and url encoded str serializers are provided with this module\n//    - disabled: [true | false]. If true serialize disabled fields.\n//    - empty: [true | false]. If true serialize empty fields\nexport function serializeForm(form, options) {\n  if (typeof options != 'object') {\n    options = { hash: !!options };\n  }\n  else if (options.hash === undefined) {\n    options.hash = true;\n  }\n\n  var result = (options.hash) ? {} : '';\n  var serializer = options.serializer || ((options.hash) ? hash_serializer : str_serialize);\n\n  var elements = form && form.elements ? form.elements : [];\n\n  // Object store each radio and set if it's empty or not\n  var radio_store = Object.create(null);\n\n  for (var i=0 ; i<elements.length ; ++i) {\n    var element = elements[i];\n\n    // NEW: Skip ignored field types\n    if (options.ignoreTypes && options.ignoreTypes.indexOf(element.type) > -1) {\n      continue;\n    }\n    // ingore disabled fields\n    if ((!options.disabled && element.disabled) || !element.name) {\n      continue;\n    }\n    // ignore anyhting that is not considered a success field\n    if (!k_r_success_contrls.test(element.nodeName) ||\n      k_r_submitter.test(element.type)) {\n      continue;\n    }\n\n    var key = element.name;\n    var val = element.value;\n\n    // we can't just use element.value for checkboxes cause some browsers lie to us\n    // they say \"on\" for value when the box isn't checked\n    if ((element.type === 'checkbox' || element.type === 'radio') && !element.checked) {\n      val = undefined;\n    }\n\n    // If we want empty elements\n    if (options.empty) {\n      if (element.type === 'checkbox' && !element.checked) {\n        val = '';\n      }\n\n      // for radio\n      if (element.type === 'radio') {\n        if (!radio_store[element.name] && !element.checked) {\n          radio_store[element.name] = false;\n        }\n        else if (element.checked) {\n          radio_store[element.name] = true;\n        }\n      }\n\n      // if options empty is true, continue only if its radio\n      if (val == undefined && element.type == 'radio') {\n        continue;\n      }\n    }\n    else {\n      // value-less fields are ignored unless options.empty is true\n      if (!val) {\n        continue;\n      }\n    }\n\n    // multi select boxes\n    if (element.type === 'select-multiple') {\n      val = [];\n\n      var selectOptions = element.options;\n      var isSelectedOptions = false;\n      for (var j=0 ; j<selectOptions.length ; ++j) {\n        var option = selectOptions[j];\n        var allowedEmpty = options.empty && !option.value;\n        var hasValue = (option.value || allowedEmpty);\n        if (option.selected && hasValue) {\n          isSelectedOptions = true;\n\n          // If using a hash serializer be sure to add the\n          // correct notation for an array in the multi-select\n          // context. Here the name attribute on the select element\n          // might be missing the trailing bracket pair. Both names\n          // \"foo\" and \"foo[]\" should be arrays.\n          if (options.hash && key.slice(key.length - 2) !== '[]') {\n            result = serializer(result, key + '[]', option.value);\n          }\n          else {\n            result = serializer(result, key, option.value);\n          }\n        }\n      }\n\n      if (!isSelectedOptions && options.empty) {\n        result = serializer(result, key, '');\n      }\n      continue;\n    }\n\n    result = serializer(result, key, val);\n  }\n\n  if (options.empty) {\n    for (var key in radio_store) {\n      if (!radio_store[key]) {\n        result = serializer(result, key, '');\n      }\n    }\n  }\n\n  return result;\n}\n\nfunction parse_keys(string) {\n  var keys = [];\n  var prefix = /^([^\\[\\]]*)/;\n  var children = new RegExp(brackets);\n  var match = prefix.exec(string);\n\n  if (match[1]) {\n      keys.push(match[1]);\n  }\n\n  while ((match = children.exec(string)) !== null) {\n      keys.push(match[1]);\n  }\n\n  return keys;\n}\n\nfunction hash_assign(result, keys, value) {\n  if (keys.length === 0) {\n    result = value;\n    return result;\n  }\n\n  var key = keys.shift();\n  var between = key.match(/^\\[(.+?)\\]$/);\n\n  if (key === '[]') {\n    result = result || [];\n\n    if (Array.isArray(result)) {\n      result.push(hash_assign(null, keys, value));\n    }\n    else {\n      // This might be the result of bad name attributes like \"[][foo]\",\n      // in this case the original `result` object will already be\n      // assigned to an object literal. Rather than coerce the object to\n      // an array, or cause an exception the attribute \"_values\" is\n      // assigned as an array.\n      result._values = result._values || [];\n      result._values.push(hash_assign(null, keys, value));\n    }\n\n    return result;\n  }\n\n  // Key is an attribute name and can be assigned directly.\n  if (!between) {\n    result[key] = hash_assign(result[key], keys, value);\n  }\n  else {\n    var string = between[1];\n    // +var converts the variable into a number\n    // better than parseInt because it doesn't truncate away trailing\n    // letters and actually fails if whole thing is not a number\n    var index = +string;\n\n    // If the characters between the brackets is not a number it is an\n    // attribute name and can be assigned directly.\n    if (isNaN(index)) {\n      result = result || {};\n      result[string] = hash_assign(result[string], keys, value);\n    }\n    else {\n      result = result || [];\n      result[index] = hash_assign(result[index], keys, value);\n    }\n  }\n\n  return result;\n}\n\n// Object/hash encoding serializer.\nfunction hash_serializer(result, key, value) {\n  var matches = key.match(brackets);\n\n  // Has brackets? Use the recursive assignment function to walk the keys,\n  // construct any missing objects in the result tree and make the assignment\n  // at the end of the chain.\n  if (matches) {\n    var keys = parse_keys(key);\n    hash_assign(result, keys, value);\n  }\n  else {\n    // Non bracket notation can make assignments directly.\n    var existing = result[key];\n\n    // If the value has been assigned already (for instance when a radio and\n    // a checkbox have the same name attribute) convert the previous value\n    // into an array before pushing into it.\n    //\n    // NOTE: If this requirement were removed all hash creation and\n    // assignment could go through `hash_assign`.\n    if (existing) {\n      if (!Array.isArray(existing)) {\n        result[key] = [ existing ];\n      }\n\n      result[key].push(value);\n    }\n    else {\n      result[key] = value;\n    }\n  }\n\n  return result;\n}\n\n// urlform encoding serializer\nfunction str_serialize(result, key, value) {\n  // encode newlines as \\r\\n cause the html spec says so\n  value = value.replace(/(\\r)?\\n/g, '\\r\\n');\n  value = encodeURIComponent(value);\n\n  // spaces should be '+' rather than '%20'.\n  value = value.replace(/%20/g, '+');\n  return result + (result ? '&' : '') + encodeURIComponent(key) + '=' + value;\n}\n","export function timer(num){\n  if (this instanceof timer === false) {\n    return new timer(num);\n  }\n  this.count = num || 0;\n  return this;\n}\n\ntimer.prototype.start = function(){\n  var self = this;\n  this.pause();\n  this.interval = setInterval(function(){\n    self.count++;\n  }, 1000);\n  return this;\n};\n\ntimer.prototype.pause = function(){\n  clearInterval(this.interval);\n  return this;\n};\n\ntimer.prototype.value = function(){\n  return this.count;\n};\n\ntimer.prototype.clear = function(){\n  this.count = 0;\n  return this;\n};\n","import KeenCore from './index';\nimport each from 'keen-core/lib/utils/each';\nimport extend from 'keen-core/lib/utils/extend';\nimport { listenerCore } from './utils/listener'; // (KeenCore)\nimport {\n  recordEvent,\n  recordEvents,\n  addEvent,\n  addEvents\n} from './record-events-browser';\nimport {\n  deferEvent,\n  deferEvents,\n  queueCapacity,\n  queueInterval,\n  recordDeferredEvents\n} from './defer-events';\nimport { extendEvent, extendEvents } from './extend-events';\nimport { initAutoTrackingCore } from './browser-auto-tracking';\nimport { getBrowserProfile } from './helpers/getBrowserProfile';\nimport { getDatetimeIndex } from './helpers/getDatetimeIndex';\nimport { getDomainName } from './helpers/getDomainName';\nimport { getDomNodePath } from './helpers/getDomNodePath';\nimport { getDomNodeProfile } from './helpers/getDomNodeProfile';\nimport { getScreenProfile } from './helpers/getScreenProfile';\nimport { getScrollState } from './helpers/getScrollState';\nimport { getUniqueId } from './helpers/getUniqueId';\nimport { getWindowProfile } from './helpers/getWindowProfile';\nimport { cookie } from './utils/cookie';\nimport { deepExtend } from './utils/deepExtend';\nimport { serializeForm } from './utils/serializeForm';\nimport { timer } from './utils/timer';\n\n  // ------------------------\n  // Methods\n  // ------------------------\n  extend(KeenCore.prototype, {\n    recordEvent,\n    recordEvents,\n    addEvent,\n    addEvents\n  });\n  extend(KeenCore.prototype, {\n    deferEvent,\n    deferEvents,\n    queueCapacity,\n    queueInterval,\n    recordDeferredEvents\n  });\n  extend(KeenCore.prototype, {\n    extendEvent,\n    extendEvents\n  });\n\n  // ------------------------\n  // Auto-Tracking\n  // ------------------------\n  const initAutoTracking = initAutoTrackingCore(KeenCore);\n  extend(KeenCore.prototype, {\n    initAutoTracking\n  });\n\n  // ------------------------\n  // Deprecated\n  // ------------------------\n  KeenCore.prototype.trackExternalLink = trackExternalLink;\n\n  // ------------------------\n  // Helpers\n  // ------------------------\n  extend(KeenCore.helpers, {\n    getBrowserProfile,\n    getDatetimeIndex,\n    getDomainName,\n    getDomNodePath,\n    getDomNodeProfile,\n    getScreenProfile,\n    getScrollState,\n    getUniqueId,\n    getWindowProfile\n  });\n\n  // ------------------------\n  // Utils\n  // ------------------------\n  const listener = listenerCore(KeenCore);\n  extend(KeenCore.utils, {\n    cookie,\n    deepExtend,\n    listener,\n    serializeForm,\n    timer\n  });\n\n  KeenCore.listenTo = function(listenerHash){\n    each(listenerHash, function(callback, key){\n      var split = key.split(' ');\n      var eventType = split[0],\n          selector = split.slice(1, split.length).join(' ');\n      // Create an unassigned listener\n      return listener(selector).on(eventType, callback);\n    });\n  };\n\n  // ------------------------------\n  // DEPRECATED\n  // Apply client.globalProperties\n  // ------------------------------\n  function trackExternalLink(jsEvent, eventCollection, payload, timeout, timeoutCallback){\n    this.emit('error', 'This method has been deprecated. Check out DOM listeners: https://github.com/keen/keen-tracking.js#listeners');\n    var evt = jsEvent,\n      target = (evt.currentTarget) ? evt.currentTarget : (evt.srcElement || evt.target),\n      timer = timeout || 500,\n      triggered = false,\n      targetAttr = '',\n      callback,\n      win;\n    if (target.getAttribute !== void 0) {\n      targetAttr = target.getAttribute('target');\n    } else if (target.target) {\n      targetAttr = target.target;\n    }\n    if ((targetAttr == '_blank' || targetAttr == 'blank') && !evt.metaKey) {\n      win = window.open('about:blank');\n      win.document.location = target.href;\n    }\n    if (target.nodeName === 'A') {\n      callback = function(){\n        if(!triggered && !evt.metaKey && (targetAttr !== '_blank' && targetAttr !== 'blank')){\n          triggered = true;\n          window.location = target.href;\n        }\n      };\n    }\n    else if (target.nodeName === 'FORM') {\n      callback = function(){\n        if(!triggered){\n          triggered = true;\n          target.submit();\n        }\n      };\n    }\n    else {\n      this.trigger('error', '#trackExternalLink method not attached to an <a> or <form> DOM element');\n    }\n    if (timeoutCallback) {\n      callback = function(){\n        if(!triggered){\n          triggered = true;\n          timeoutCallback();\n        }\n      };\n    }\n    this.recordEvent(eventCollection, payload, callback);\n    setTimeout(callback, timer);\n    if (!evt.metaKey) {\n      return false;\n    }\n  }\n\n  // IE-specific polyfills, yay!\n  // -----------------------------\n  if (!Array.prototype.indexOf){\n    Array.prototype.indexOf = function(elt /*, from*/) {\n      var len = this.length >>> 0;\n\n      var from = Number(arguments[1]) || 0;\n      from = (from < 0)\n           ? Math.ceil(from)\n           : Math.floor(from);\n      if (from < 0)\n        from += len;\n\n      for (; from < len; from++) {\n        if (from in this &&\n            this[from] === elt)\n          return from;\n      }\n      return -1;\n    };\n  }\n\nexport const Keen = KeenCore.extendLibrary(KeenCore);\nexport default Keen;\n"],"sourceRoot":""}